<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>epiworld: General parameters</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">epiworld
   &#160;<span id="projectnumber">0.0-1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">General parameters </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The following are parameters used for both ABM and Compartmental models.</p>
<div class="fragment"><div class="line">EPI_BETA  &lt;- 0.75</div>
<div class="line">EPI_GAMMA &lt;- 0.33</div>
<div class="line">EPI_LATENCY &lt;- 1/0.33</div>
<div class="line">EPI_N     &lt;- 10000</div>
<div class="line">EPI_0     &lt;- 0.01</div>
<div class="line">EPI_NDAYS &lt;- 50</div>
<div class="line"> </div>
<div class="line">Sys.setenv( # nolint</div>
<div class="line">    EPI_BETA  = EPI_BETA,</div>
<div class="line">    EPI_GAMMA = EPI_GAMMA,</div>
<div class="line">    EPI_LATENCY = EPI_LATENCY,</div>
<div class="line">    EPI_N     = EPI_N,</div>
<div class="line">    EPI_0     = EPI_0,</div>
<div class="line">    EPI_NDAYS = EPI_NDAYS</div>
<div class="line">)</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md22"></a>
Compartmental Models</h1>
<h2><a class="anchor" id="autotoc_md23"></a>
SIR Model</h2>
<div class="fragment"><div class="line">library(deSolve)</div>
<div class="line">library(ggplot2)</div>
<div class="line">library(data.table)</div>
<div class="line"> </div>
<div class="line"># Code from</div>
<div class="line"># Chapter 2: SIR</div>
<div class="line"># Book &quot;Epidemics: Models and Data using R.&quot;</div>
<div class="line"># By: Ottar N. Bjørnstad</div>
<div class="line">sirmod &lt;- function(t, y, parms) {</div>
<div class="line"> </div>
<div class="line">    # Pull state variables from the vector y</div>
<div class="line">    S = y[1]</div>
<div class="line">    I = y[2]</div>
<div class="line">    R = y[3]</div>
<div class="line">    </div>
<div class="line">    # Pull parameter values from parms vector</div>
<div class="line">    beta  = parms[&quot;beta&quot;]</div>
<div class="line">    mu    = parms[&quot;mu&quot;]</div>
<div class="line">    gamma = parms[&quot;gamma&quot;]</div>
<div class="line">    N     = parms[&quot;N&quot;]</div>
<div class="line">    </div>
<div class="line">    # Define equations</div>
<div class="line">    dS  = mu * (N - S) - beta * S * I/N</div>
<div class="line">    dI  = beta * S * I/N - (mu + gamma) * I</div>
<div class="line">    dR  = gamma * I - mu * R</div>
<div class="line">    res = c(dS, dI, dR)</div>
<div class="line">    </div>
<div class="line">    # Return list of gradients</div>
<div class="line">    list(res)</div>
<div class="line"> </div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"># Initial parameters</div>
<div class="line">times &lt;- seq(0, EPI_NDAYS, by = 1)</div>
<div class="line">parms &lt;- c(mu = 0, N = EPI_N, beta = EPI_BETA, gamma = EPI_GAMMA)</div>
<div class="line">start &lt;- c(S = EPI_N * (1 - EPI_0), I = EPI_N * EPI_0, R = 0)</div>
</div><!-- fragment --><div class="fragment"><div class="line">out &lt;- ode(y = start, times = times, func = sirmod, parms= parms)</div>
<div class="line">out &lt;- as.data.frame(out)</div>
<div class="line">out &lt;- rbind(</div>
<div class="line">    with(out, data.table(date = time, state = &quot;Susceptible&quot;, counts = S)),</div>
<div class="line">    with(out, data.table(date = time, state = &quot;Infected&quot;, counts = I)),</div>
<div class="line">    with(out, data.table(date = time, state = &quot;Recovered&quot;, counts = R))</div>
<div class="line">)</div>
</div><!-- fragment --><p>Now we visualize the model</p>
<div class="fragment"><div class="line">ggplot(out, aes(x = date, y = counts)) +</div>
<div class="line">    geom_line(aes(colour = state)) +</div>
<div class="line">    labs(title = &quot;Compartmental SIR&quot;)</div>
</div><!-- fragment --><p><img src="09-sir-connected_files/figure-commonmark/visualize-1.png" alt="" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md24"></a>
SEIR Model</h2>
<div class="fragment"><div class="line"># Code adapted from</div>
<div class="line"># Chapter 2: SIR</div>
<div class="line"># Book &quot;Epidemics: Models and Data using R&quot;</div>
<div class="line"># By: Ottar N. Bjørnstad</div>
<div class="line">seirmod &lt;- function(t, y, parms) {</div>
<div class="line"> </div>
<div class="line">    # Pull state variables from y vector</div>
<div class="line">    S = y[1]</div>
<div class="line">    E = y[2]</div>
<div class="line">    I = y[3]</div>
<div class="line">    R = y[4]</div>
<div class="line">    </div>
<div class="line">    # Pull parameter values from parms vector</div>
<div class="line">    beta  = parms[&quot;beta&quot;]</div>
<div class="line">    mu    = parms[&quot;mu&quot;]</div>
<div class="line">    alpha = parms[&quot;alpha&quot;]</div>
<div class="line">    gamma = parms[&quot;gamma&quot;]</div>
<div class="line">    N     = parms[&quot;N&quot;]</div>
<div class="line">    </div>
<div class="line">    # Define equations</div>
<div class="line">    dS  = mu * (N - S) - beta * S * I/N - mu * S</div>
<div class="line">    dE  = beta * S * I/N - (mu + alpha) * E</div>
<div class="line">    dI  = alpha * E - (mu + gamma) * I</div>
<div class="line">    dR  = gamma * I - mu * R</div>
<div class="line">    res = c(dS, dE, dI, dR)</div>
<div class="line">    </div>
<div class="line">    # Return list of gradients</div>
<div class="line">    list(res)</div>
<div class="line"> </div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"># Initial parameters</div>
<div class="line">parms &lt;- c(</div>
<div class="line">    mu = 0, N = EPI_N, beta = EPI_BETA,</div>
<div class="line">    alpha = 1/EPI_LATENCY, gamma = EPI_GAMMA</div>
<div class="line">    )</div>
<div class="line">start &lt;- c(S = EPI_N * (1 - EPI_0), E = EPI_N * EPI_0, I = 0, R = 0)</div>
</div><!-- fragment --><div class="fragment"><div class="line">out_seir &lt;- ode(y = start, times = times, func = seirmod, parms = parms)</div>
<div class="line">out_seir &lt;- as.data.frame(out_seir)</div>
<div class="line">out_seir &lt;- rbind(</div>
<div class="line">    with(out_seir, data.table(date = time, state = &quot;Susceptible&quot;, counts = S)),</div>
<div class="line">    with(out_seir, data.table(date = time, state = &quot;Exposed&quot;, counts = E)),</div>
<div class="line">    with(out_seir, data.table(date = time, state = &quot;Infected&quot;, counts = I)),</div>
<div class="line">    with(out_seir, data.table(date = time, state = &quot;Recovered&quot;, counts = R))</div>
<div class="line">)</div>
</div><!-- fragment --><p>Now we visualize the model</p>
<div class="fragment"><div class="line">ggplot(out_seir, aes(x = date, y = counts)) +</div>
<div class="line">    geom_line(aes(colour = state)) +</div>
<div class="line">    labs(title = &quot;Compartmental SEIR&quot;)</div>
</div><!-- fragment --><p><img src="09-sir-connected_files/figure-commonmark/visualize-seir-1.png" alt="" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md25"></a>
Agent-Based Model Approach</h1>
<p>Calculation of the expected number of days in state $a$ when prob of changing state equals $\alpha$ is $1/\alpha$</p>
<div class="fragment"><div class="line">set.seed(712)</div>
<div class="line">a &lt;- .3</div>
<div class="line">R &lt;- matrix(runif(2e5 * 50), ncol = 50)</div>
<div class="line">dat &lt;- apply(R, 1, \&zwj;(x) {</div>
<div class="line">    which.max(x &lt; a)</div>
<div class="line">})</div>
<div class="line"> </div>
<div class="line">mean(dat) - 1 / a</div>
</div><!-- fragment --> <pre class="fragment">[1] -0.01049333
</pre> <h2><a class="anchor" id="autotoc_md26"></a>
Mathematical preliminaries</h2>
<p>That agent $i$ becomes infected can be computed as follows:</p>
<p>At the same time, the probability of not becoming infected equals to the probability of no infected agent transmitting the infection. The probability that agent $j$ infects $i$ equals</p>
<p>In this case, $\beta$ is parametrized such that its values are within $(0,1)$. Since transmission from the $I$ infected agents happens independently, we finally have the following:</p>
<p>With the above equation, we can now calculate the change in the number of susceptible agents. In this case, it equals the expected number of new infections:</p>
<p>With the same parametrization in the canonical SIR model (Kermack and McKendrick), the instantaneous change in the number of susceptible agents equals $\frac{\delta}{\delta t}S = -S \beta I$. Given $S$ and $I$, we can show that, as $\beta\downarrow 0$, i.e., the population grows, both rates converge to the same number. Formally:</p>
<p>The same can be shown for the change in the number recovered.</p>
<h2><a class="anchor" id="autotoc_md27"></a>
Simulation study</h2>
<p>Now, what happens with <code>epiworld</code>.</p>
<div class="fragment"><div class="line">system(&quot;./09-sir-connected.o -n $EPI_N -b $EPI_BETA -d $EPI_NDAYS -p $EPI_0 -r $EPI_GAMMA -i 1.0 -s555599&quot;)</div>
</div><!-- fragment --><div class="fragment"><div class="line">library(ggplot2)</div>
<div class="line">epiworld &lt;- data.table::fread(&quot;total_hist.txt&quot;)</div>
<div class="line">ggplot(epiworld, aes(x = date, y = counts)) +</div>
<div class="line">    geom_line(aes(colour = state)) +</div>
<div class="line">    labs(title = &quot;ABM SIR&quot;)</div>
</div><!-- fragment --><p><img src="09-sir-connected_files/figure-commonmark/abm-sir-1.png" alt="" class="inline"/></p>
<div class="fragment"><div class="line">system(&quot;./09-seir-connected.o -n $EPI_N -b $EPI_BETA -d $EPI_NDAYS -p $EPI_0 -r $EPI_GAMMA -i 1.0 -s555599 -l $EPI_LATENCY&quot;)</div>
</div><!-- fragment --><div class="fragment"><div class="line">library(ggplot2)</div>
<div class="line">epiworld &lt;- data.table::fread(&quot;total_hist.txt&quot;)</div>
<div class="line">ggplot(epiworld, aes(x = date, y = counts)) +</div>
<div class="line">    geom_line(aes(colour = state)) +</div>
<div class="line">    labs(title = &quot;ABM SEIR&quot;)</div>
</div><!-- fragment --><p><img src="09-sir-connected_files/figure-commonmark/abm-seir-1.png" alt="" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md28"></a>
Comparing ABM with Compartmental Models</h1>
<p>To this end, we will compare the results of the first run of the Compartmental model with 100 runs of the ABM, compute the confidence interval, and see how likely is the compartmental model to fall within the trajectory of the ABM simulation.</p>
<h2><a class="anchor" id="autotoc_md29"></a>
SIR</h2>
<div class="fragment"><div class="line">system(&quot;./09-sir-connected.o -n $EPI_N -b $EPI_BETA -d $EPI_NDAYS -p $EPI_0 -r $EPI_GAMMA -i 1.0 -s555599 -e 100&quot;)</div>
</div><!-- fragment --><div class="fragment"><div class="line">library(ggplot2)</div>
<div class="line">library(data.table)</div>
<div class="line">epiworld &lt;- data.table::fread(&quot;09-sir-connected-experiments.csv&quot;)</div>
<div class="line">epiworld &lt;- epiworld[, .(</div>
<div class="line">    min  = quantile(counts, probs = .025),</div>
<div class="line">    mean = mean(counts),</div>
<div class="line">    max  = quantile(counts, probs = .975)), by = .(date, state)]</div>
<div class="line"> </div>
<div class="line"># Merging Compartmental</div>
<div class="line">epiworld &lt;- merge(</div>
<div class="line">    epiworld,</div>
<div class="line">    out[, .(date = date, state = state, compartmental = counts)],</div>
<div class="line">    by = c(&quot;date&quot;, &quot;state&quot;)</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">setorder(epiworld, state, date)</div>
<div class="line">ggplot(epiworld, aes(x = date, y = mean)) +</div>
<div class="line">    geom_ribbon(aes(ymin = min, ymax = max, colour = state), alpha = 0.1) +</div>
<div class="line">    geom_line(aes(x = date, y = compartmental, colour = sprintf(&quot;%s (compt)&quot;, state)))</div>
</div><!-- fragment --><p><img src="09-sir-connected_files/figure-commonmark/experiment100-1.png" alt="" class="inline"/></p>
<p>It seems that, although both yield the same equilibria, compartmental models reach the highest point of the simulation earlier. This makes sense as within a single day of the ABM simulation, compartmental models have more events taking place. Nonetheless, as predicted, as $\beta\downarrow 0$, the differences become lesser. Furthermore, we could use the fact that the transition rates are known to compute an adjustment.</p>
<h2><a class="anchor" id="autotoc_md30"></a>
SEIR</h2>
<div class="fragment"><div class="line">system(&quot;./09-seir-connected.o -n $EPI_N -b $EPI_BETA -d $EPI_NDAYS -p $EPI_0 -r $EPI_GAMMA -i 1.0 -s555599 -e 100 -l $EPI_LATENCY&quot;)</div>
</div><!-- fragment --><div class="fragment"><div class="line">library(ggplot2)</div>
<div class="line">library(data.table)</div>
<div class="line">epiworld_seir &lt;- data.table::fread(&quot;09-seir-connected-experiments.csv&quot;)</div>
<div class="line">epiworld_seir &lt;- epiworld_seir[, .(</div>
<div class="line">    min  = quantile(counts, probs = .025),</div>
<div class="line">    mean = mean(counts),</div>
<div class="line">    max  = quantile(counts, probs = .975)), by = .(date, state)]</div>
<div class="line"> </div>
<div class="line"># Merging Compartmental</div>
<div class="line">epiworld_seir &lt;- merge(</div>
<div class="line">    epiworld_seir,</div>
<div class="line">    out_seir[, .(date = date, state = state, compartmental = counts)],</div>
<div class="line">    by = c(&quot;date&quot;, &quot;state&quot;)</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">setorder(epiworld_seir, state, date)</div>
<div class="line">ggplot(epiworld_seir, aes(x = date, y = mean)) +</div>
<div class="line">    geom_ribbon(aes(ymin = min, ymax = max, colour = state), alpha = 0.1) +</div>
<div class="line">    geom_line(aes(x = date, y = compartmental, colour = sprintf(&quot;%s (compt)&quot;, state)))</div>
</div><!-- fragment --><p><img src="09-sir-connected_files/figure-commonmark/experiment100-seir-1.png" alt="" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md31"></a>
Rates</h2>
<div class="fragment"><div class="line">S &lt;- 1000</div>
<div class="line">rate_comp &lt;- function(I,B) S * B * I</div>
<div class="line"> </div>
<div class="line">rate_abm &lt;- function(I,B) S * (1 - (1 - B)^I)</div>
<div class="line"> </div>
<div class="line">op &lt;- par(mfrow = c(3, 2))</div>
<div class="line">for (i in c(1, 10, 100)) {</div>
<div class="line">    curve(rate_comp(i, x), from = .01, to = 0.05)</div>
<div class="line">    curve(rate_abm(i, x), from = .01, to = 0.05, add = FALSE, lty = 2)</div>
<div class="line">}</div>
</div><!-- fragment --><p><img src="09-sir-connected_files/figure-commonmark/comparing-rates-seir-1.png" alt="" class="inline"/></p>
<div class="fragment"><div class="line">par(op)</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
