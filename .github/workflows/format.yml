name: Clang Format Check

on:
    pull_request:
        paths:
            - "**.cpp"
            - "**.h"
            - "**.hpp"
            - "**.cc"
            - "**.cxx"

jobs:
    clang-format:
        name: Check C++ Formatting
        runs-on: ubuntu-latest

        steps:
            - name: Checkout code
              uses: actions/checkout@v4

            - name: Install clang-format
              run: sudo apt-get install -y clang-format

            - name: Find C++ files
              id: files
              run: |
                  FILES=$(find . -type f \( -name "*.cpp" -o -name "*.cc" -o -name "*.cxx" -o -name "*.h" -o -name "*.hpp" \))
                  echo "files=$FILES" >> $GITHUB_OUTPUT

            - name: Run clang-format
              run: |
                  echo "${{ steps.files.outputs.files }}" | xargs clang-format -style=file -i

            - name: Check for formatting changes
              run: |
                  if ! git diff --exit-code; then
                    echo "Formatting issues found. Please run clang-format.";
                    exit 1;
                  fi
